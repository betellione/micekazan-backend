@using WebApp1.Enums
@model TemplateViewModel

@{
}

<form asp-controller="Settings" method="post" enctype="multipart/form-data">
    <input asp-for="Id" hidden/>

    <div class="content_block">
        <div class="content_row">
            <table>
                <tr>
                    <td><p>Цвет шрифта<p></td>
                    <td colspan="3">
                        <input asp-for="FontColor" type="color" id="card_color_input">
                    </td>
                </tr>

                <tr>
                    <td><p>Вертикальная</p></td>
                    <td>
                        <label class="custom-radio-btm">
                            @Html.RadioButtonFor(m => m.PageOrientation, PageOrientation.Vertical, new { @class = "ticket-orientation-vertical", })
                            <span class="point"></span>
                        </label>
                    </td>
                    <td><p>Горизонтальная</p></td>
                    <td>
                        <label class="custom-radio-btm">
                            @Html.RadioButtonFor(m => m.PageOrientation, PageOrientation.Horizontal, new { @class = "ticket-orientation-horizontal", })
                            <span class="point"></span>
                        </label>
                    </td>
                </tr>

                <tr>
                    <td><p>Имя</p></td>
                    <td>
                        <label asp-for="DisplayName" class="custom-checkbox-btm">
                            <input asp-for="DisplayName" id="card_firstname_input" checked="checked"/>
                            <!--@Html.DisplayNameFor(m => m.DisplayName)-->
                            <span class="point"></span>
                        </label>
                    </td>
                    <td><p>Фамилия</p></td>
                    <td>
                        <label asp-for="DisplaySurname" class="custom-checkbox-btm">
                            <input asp-for="DisplaySurname" id="card_lastname_input" checked="checked"/>
                            <!--@Html.DisplayNameFor(m => m.DisplaySurname)-->
                            <span class="point"></span>
                        </label>
                    </td>
                </tr>

                <tr>
                    <td><p>QR код</p></td>
                    <td>
                        <label asp-for="DisplayQrCode" class="custom-checkbox-btm">
                            <input asp-for="DisplayQrCode" id="card_qr_input" checked="checked"/>
                            <!--@Html.DisplayNameFor(m => m.DisplayQrCode)-->
                            <span class="point"></span>
                        </label>
                    </td>
                </tr>

                <tr>
                    <td>
                        <p><label asp-for="Logo"></label></p>
                    </td>
                    <td>
                        <label class="custom-file-btm">
                            <input asp-for="Logo" id="card_logo_input">
                            <span asp-validation-for="Logo">ЗАГРУЗИТЬ ФАЙЛ</span>
                        </label>
                    </td>
                </tr>

                <tr>
                    <td>
                        <p><label asp-for="Background"></label></p>
                    </td>
                    <td>
                        <label class="custom-file-btm">
                            <input asp-for="Background" id="card_background_input">
                            <span asp-validation-for="Background">ЗАГРУЗИТЬ ФАЙЛ</span>
                        </label>
                    </td>
                </tr>
            </table>
        </div>

        <div class="content_row">
            <div class="preview_block">
                <div class="preview vertical" id="print_card_component" style="background-image: url('@Model.BackgroundPath');">
                    <div class="preview_logo">
                        <img id="card_logo" alt="" src="@Model.LogoPath">
                    </div>
                    <div class="preview_info">
                        <div class="preview_name" id="card_firstname">
                            Сергеей
                        </div>
                        <div class="preview_surname" id="card_lastname">
                            Прокофьев
                        </div>
                        <div class="preview_qr" id="card_qr">
                            <img src="/images/qr_logo.png" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="content_bottom">
        @if (Model.Id is not null)
        {
            <div class="custom-btm">
                <button type="submit" asp-action="UpdateTemplate">Сохранить</button>
            </div>
        }

        <div class="custom-btm">
            <button type="submit" asp-action="SaveTemplateAsNew">Сохранить как ШАБЛОН</button>
        </div>
    </div>
</form>

<script>
    const print_card = document.getElementById('print_card_component');

    // Горизонтальная ориентация
    document.querySelector(".ticket-orientation-horizontal").addEventListener("change", (event) => {
        if (event.target.checked) {
            print_card.classList.remove('vertical');
            print_card.classList.add('horizon');
        }
    });

    // Вертикальная ориентация
    let vertical = document.querySelector(".ticket-orientation-vertical");
    vertical.checked = true;
    vertical.addEventListener("change", (event) => {    
        if (event.target.checked) {
            print_card.classList.remove('horizon');
            print_card.classList.add('vertical');
        }
    });

    // Отображение (Имя)
    document.getElementById('card_firstname_input').addEventListener("change", (event) => {
        if (event.target.checked) {
            print_card.querySelector("#card_firstname").style.opacity = "1";
        } else {
            print_card.querySelector("#card_firstname").style.opacity = "0";
        }
    });
    // Отображение (Фамилия)
    document.getElementById('card_lastname_input').addEventListener("change", (event) => {
        if (event.target.checked) {
            print_card.querySelector("#card_lastname").style.opacity = "1";
        } else {
            print_card.querySelector("#card_lastname").style.opacity = "0";
        }
    });
    // Отображение (QR)
    document.getElementById('card_qr_input').addEventListener("change", (event) => {
        if (event.target.checked) {
            print_card.querySelector("#card_qr").style.opacity = "1";
        } else {
            print_card.querySelector("#card_qr").style.opacity = "0";
        }
    });

    // Цвет текста
    document.getElementById('card_color_input').addEventListener("change", (event) => {
        print_card.style.color = event.target.value;
    });

    // Логотип
    document.getElementById('card_logo_input').addEventListener("change", (event) => {
        print_card.querySelector("#card_logo").src = URL.createObjectURL(event.target.files[0]);
    });

    // Фон
    document.getElementById('card_background_input').addEventListener("change", (event) => {
        let file = URL.createObjectURL(event.target.files[0]);
        print_card.style.backgroundImage = `url(${file})`;
    });
</script>